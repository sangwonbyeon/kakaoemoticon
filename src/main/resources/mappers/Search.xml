<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.korit.kakaoemotionshop.repository.HotSearchRepository">

    <select id="getUserSearchEmoTotalCount"
            parameterType="com.korit.kakaoemotionshop.web.dto.HotSearchReqDto"
            resultType="Integer">
        select
        count(*)
        from
        emo_mst
        where
        1 = 1
        <if test='searchValue != null and searchValue != ""'>
            and (emo_name like concat('%', #{searchValue}, '%')
            or company like concat('%', #{searchValue}, '%'))
        </if>
    </select>

    <select id="userSearchEmo"
            parameterType="com.korit.kakaoemotionshop.web.dto.HotSearchReqDto"
            resultType="com.korit.kakaoemotionshop.entity.HotSearchEmo">
        select
        em.emo_id as emoImd,
        em.emo_code as emoCode,
        em.emo_name as emoName,
        em.company,
        em.emo_date as emoDate,
        ei.save_name as saveName,
        el.like_id as likeId,
        lc.like_count as likeCount
        from
        emo_mst em
        left outer join emo_image ei
        on(em.emo_code = ei.emo_code)
        left outer join emo_like el
        on( el.emo_id = em.emo_id and el.user_id = '2')
        left outer join (select
        emo_id,
        count(emo_id) as like_count
        from
        emo_like
        group by
        emo_id) lc on (lc.emo_id = em.emo_id)
        where
        1 = 1
        <if test='searchValue != null and searchValue != ""'>
            and (emo_name like cocat('%', #{searchValue}, '%')
            or company like concat('%', #{searchValue}, '%')
        </if>

        limit #{index}, #{count}

    </select>


</mapper>